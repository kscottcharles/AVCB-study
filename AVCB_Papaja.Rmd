---
title             : "Authoritarian Values and Colorblindness"
shorttitle        : "AVCB"

author: 
  - name          : "Kaila Scott-Charles"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
    role: # Contributorship roles (e.g., CRediT, https://credit.niso.org/)
      - "Conceptualization"
      - "Writing - Original Draft Preparation" 
      - "Writing - Review & Editing"
  - name          : "Isobel Heck"
    affiliation   : "2"
    role:
      - "Writing - Review & Editing"
      - "Supervision"

affiliation:
  - id            : "1"
    institution   : "University of Chicago"
  - id            : "2"
    institution   : "University of Rochester"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  One or two sentences to put the results into a more **general context**.
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : "r-references.bib"

floatsintext      : no
linenumbers       : yes
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
r_refs("r-references.bib")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)

```

```{r}
#load packages

library(dplyr)
library(tidyverse)
library(readr)
library(ggplot2)

```

```{r load data, include=FALSE}
AVCB_wp_kids <- read.csv("Data/AVCB_wp_kids.csv", na.strings = c("", "NA", "#N/A"))
AVCB_wp_parents <- read.csv("Data/AVCB_wp_parents.csv", na.strings = "")

```

```{r combine files, include=FALSE}
#combine files
AVCB_wp_dyads <- merge(AVCB_wp_kids, AVCB_wp_parents, by = "Family_ID")

#renaming variables
AVCB_wp_dyads <- rename(AVCB_wp_dyads, "Single Child ID" = "ID.x")
AVCB_wp_dyads <- rename(AVCB_wp_dyads, "All Child IDs" = "ID.y")
AVCB_wp_dyads <- rename(AVCB_wp_dyads, "Child Version" = "Version.x")
AVCB_wp_dyads <- rename(AVCB_wp_dyads, "Parent Version" = "Version.y")
AVCB_wp_dyads <- rename(AVCB_wp_dyads, "Child_CB_Self_choice" = "CB_Self_choice.x")
AVCB_wp_dyads <- rename(AVCB_wp_dyads, "Parent_CB_Self_choice" = "CB_Self_choice.y")

```

```{r create intermediate dataset, include=FALSE}
#Checking column names before creating ID
print(names(AVCB_wp_dyads))

AVCB_wp_dyads_ID <- AVCB_wp_dyads |> 
  select(Family_ID:Gender, P1_Race.Eth, P2_Race.Eth, P1_pol:P2_ed, Child_CB_Self_choice, CB_Parents_choice, RE_Ind_Self_choice:Parent_sum, RE_Ind:WB_Cons,COBRAS_1_num:AV_sum)

#moving AV choice variables tgo right before AV num variables (for parents) - will want to rename these later so that it's clear which ones are kid vs. parent variables

AVCB_wp_dyads_ID <- AVCB_wp_dyads_ID |> 
  relocate(RE_Ind:WB_Cons, .before = RE_Ind_num)

AVCB_wp_dyads_ID

#Checking column names
print(names(AVCB_wp_dyads_ID))

```

```{r save intermediate dataset, include=FALSE}
write_csv(AVCB_wp_dyads_ID, "AVCB_wp_dyads_ID.csv")

```

# **Heading 1 (bolded)**  
xyz

## *Heading 2 (italicized)*  
xyz

### Heading 3  
xyz  

# Starting Lists from HW5

**Unordered list**

* This is the first line in my unordered list
* Here is another line in the list
    + This is an indented line
* Here is another line in the unordered list


**Ordered List**  

1. First line
2. Second line
3. Third line
    + Item 3a
    + Item 3b



**Here, I am inserting a url**  
[This is a link to the RStudio website](https://www.rstudio.com)

<!-- This is my HTML-style comment. I can see this, but it won't show up when I knit the document -->


```{r call-function, echo=FALSE}
#Assignment 5 - call function
#source("functions.R")
#hello_world("Kaila")

```
# **Mock up 2 plots (of 2 different types) you could include in your final report**

# **H1 Plot**
```{r H1 Plot, eval=TRUE, include=TRUE}
#H1: Parents’ authoritarian values will positively predict children’s own authoritarian values and this relation will strengthen with age.    
    
#Scatterplot with parent AV score on x axis, child AV score on y axis  + smooth line with age plotted in different colors 
#Expect: Positive relation between Parent AV score and Child AV score (stronger positive relation with age)

AVCB_H1 <-read.csv("Data/AVCB_H1.csv")

p1 <- ggplot(
  data = AVCB_H1,
  mapping = aes(x = Parent_AVscore, y = Child_AVscore, color = factor(Years))) +
  geom_smooth(method = "lm") +
  geom_jitter() +
    labs(
      title = "Relation Between Parents' and Children's Authoritarian Values",
      x = "Parent Authoritarian Values Score (higher = more authoritarian)",
      y = "Child Authoritarian Values Score (higher = more authoritarian)",
      color = "Child Age (Years)"  
    ) +
  theme_minimal() +
  scale_color_brewer(palette = "Blues")


p1

#maybe better way to visualize?

p1_alt <- AVCB_H1 %>% 
ggplot(aes(x = Parent_AVscore, y = Child_AVscore, color = factor(Years))) +
  facet_grid(cols = vars(factor(Years))) +
  geom_jitter() +
  geom_smooth(method = "lm") +
  labs(title = "Side-by-Side Box Plots") +
    labs(
      title = "Relation Between Parents' and Children's Authoritarian Values By Child's Age",
      x = "Parent Authoritarian Values Score (higher = more authoritarian)",
      y = "Child Authoritarian Values Score (higher = more authoritarian)",
      color = "Child Age (Years)"
    ) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  scale_color_brewer(palette = "Dark2")

p1_alt
```

# **H2 Plot**
This hypothesis has 2 ways to test the question. This is because we tested kids' diversity ideology one way (binary choice), but we tested parents' diversity ideology two ways: 1) same binary choice measure, 2) A continuous scale measure. I will create a plot for both ways.
```{r H2 Plot, eval=TRUE, message = FALSE, warning=FALSE}
#H2: Parents’ diversity ideology will positively predict children’s own diversity ideology, and this relation will strengthen with age.   

AVCB_H2 <-read.csv("Data/AVCB_H2.csv")
    
##For child binary/parent continuous: 

#Two Boxplots of parent COBRA score comparing kids who choose CC vs. kids who choose CB 
#Expect: CB boxplots to be higher than CC box plots (and for this to strengthen with age)
  
p2a <- AVCB_H2 %>% filter(!is.na(Child_Class_Self_choice)) %>% 
ggplot(aes(x = Child_Class_Self_choice, y = COBRAS_avg, color = Child_Class_Self_choice)) +
  facet_grid(cols = vars(factor(Years))) +
  geom_boxplot() +
  geom_jitter() +                                         
    labs(
      title = "Relation Between Children's Classroom Choice and Parents' Colorblind Score \nBy Child's Age",
      x = "Child Classroom Choice",
      y = "Parent Colorblindness Score (higher = more colorblind)",
      color = "Child Age (Years)",
      caption = "CB = colorblind and CC = color-conscious"
    ) +
  theme_minimal() +
  theme(legend.position = "none") +
  coord_flip() +   
  scale_color_manual(values = c("CB" = "#6baed6", "CC" = "#2171b5"))


p2a

#Add age label/add "years"?

#maybe better visualization?

p2a_alt <- AVCB_H2 %>% filter(!is.na(Child_Class_Self_choice)) %>% 
ggplot(aes(x = factor(Years), y = COBRAS_avg, color = Child_Class_Self_choice)) +
  facet_grid(cols = vars(Child_Class_Self_choice)) +
  geom_boxplot() +
  geom_jitter() +                                         
    labs(
      title = "Relation Between Children's Classroom Choice and Parents' Colorblind Score \nBy Child's Age",
      x = "Child Age (Years)",
      y = "Parent Colorblindness Score (higher = more colorblind)",
      color = "Child Age (Years)",
      caption = "CB = colorblind and CC = color-conscious"
    ) +
  theme_minimal() +
  theme(legend.position = "none") +
  coord_flip() +
  scale_color_brewer(palette = "Dark2")

p2a_alt

##For child binary/parent binary: 

#Stacked barchart with child classroom choice (binary) on x axis with each bar broken down by parent classroom choice (binary)
#Expect: Child CB bar = higher number of parents who chose CB classroom, Child CC bar = higher number of parents who chose CC classroom

p2b <- AVCB_H2 %>% filter(!is.na(Child_Class_Self_choice)) %>%  
  ggplot(aes(x = Child_Class_Self_choice, fill = Parent_Class_Self_choice)) +
  geom_bar(position = "fill") +
  labs(title = "Child vs. Parent Classroom Choice",
       x = "Child Classroom Choice",
       y = "Count",
      fill = "Parent Classroom Choice",
      caption = "CB = colorblind and CC = color-conscious"
    ) +
  theme_minimal() +
  scale_fill_brewer(palette = "Dark2")


p2b
```

# **H3 Plot**
```{r H3 Plot, eval=TRUE, message = FALSE, warning= FALSE}
AVCB_H3 <-read.csv("Data/AVCB_H3.csv")

#H3: Higher authoritarian values will positively predict more colorblind attitudes.
    #For parents: Scatterplot with parent AV score on x axis, parent COBRA score on y axis
    #For kids: Barplot with child classroom choice (binary) on x axis and child AV score on y axis
    #Natalie's Suggestion: 2 Boxplots of parent AV score comparing kids who choose CC vs. kids who choose CB
      #But how do I add kids' age into this plot????

    #For parents: Scatterplot with parent AV score on x axis, parent COBRA score on y axis
    #Expect: Positive relation between AV score amnd COBRA score


p3a <- ggplot(
  data = AVCB_H3,
  mapping = aes(x = Parent_AVscore, y = COBRAS_avg)) +
  geom_point() +
  geom_smooth(method = "lm") +
  geom_jitter() +
    labs(
      title = "Relation Between Parents' Authoritarian Values and Colorblindness Score",
      x = "Authoritarian Values Score (higher = more authoritarian)",
      y = "Colorblindness Score (higher = more colorblind)" 
    ) +
  theme_minimal() +
  scale_color_brewer(palette = "Dark2")


p3a

    #For kids: Barplot with child classroom choice (binary) on x axis and child AV score on y axis
    #Expect: CB boxplot will be higher than CC boxplot


p3b <- AVCB_H3 %>% filter(!is.na(Child_Class_Self_choice)) %>% 
ggplot(aes(x = Child_Class_Self_choice, y = Child_AVscore, color = Child_Class_Self_choice)) +
  geom_boxplot() +
  geom_jitter()  +
    labs(
      title = "Relation Children's Classroom Choice and Authoritarian Values Score",
      x = "Classroom Choice",
      y = "Authoritarian Values Score (higher = more authoritarian)",
      caption = "CB = colorblind and CC = color-conscious",
      color = "Classroom Choice"
    ) +
  theme_minimal() +
  scale_color_brewer(palette = "Dark2")


p3b
```

```{r}
#Other ideas for plots

#How are parents and children's values related?
  #x = type of AV score (parent-actual, child, child parent perception), y = AV score
    #barplot

#How does child's values + perceptions of parents' values change with age? (facet - AV type: child AV, child perception of parent)
  #x = Age (discrete), y = child AV
    #scatterplot + smooth

#How does parents AV relate to child perceptions of parents AV
  #x = parent AV score, y = AV score (facet - child AV, child parent perception AV)
    #scatterplot + smooth


```
In Figure \@ref(my plots), you can see XYZ.

```{r my plots}
#All plots
p1
p1_alt
p2a
p2a_alt
p2b
p3a
p3b
```

```{r}
#Dems I want in my table:
  #Gender (kids)
  #Race.Eth_group (kids)
  #Income
  #P1_pol
  #P1_ed

#Factor + Recode + Level for dem table
AVCB_wp_dyads$Gender <- factor(AVCB_wp_dyads$Gender)
levels(AVCB_wp_dyads$Gender)

AVCB_wp_dyads$Race.Eth_group <- factor(AVCB_wp_dyads$Race.Eth_group)
levels(AVCB_wp_dyads$Race.Eth_group)
AVCB_wp_dyads$Race.Eth_group <- recode_factor(AVCB_wp_dyads$Race.Eth_group, "Hispanic or Latino"="Hispanic or Latino", "White or Caucasian"="White or Caucasian", "Black or African American"="Black or African American",.default = "Bi- or Multi-Racial" )

AVCB_wp_dyads$Income <- factor(AVCB_wp_dyads$Income)
levels(AVCB_wp_dyads$Income)
AVCB_wp_dyads$Income <- factor(AVCB_wp_dyads$Income, levels = c("Less than $15,000", "$20,000 to $24,999", "$35,000 to $49,999","$50,000 to $74,999", "$75,000 to $99,999", "$100,000 to $149,999", "$150,000 or more", "Prefer not to answer", "N/A"))

AVCB_wp_dyads$P1_pol <- factor(AVCB_wp_dyads$P1_pol)
levels(AVCB_wp_dyads$P1_pol)
AVCB_wp_dyads$P1_pol <- factor(AVCB_wp_dyads$P1_pol, levels = c("Extremely Conservative", "Conservative", "Slightly Conservative","Moderate, Middle of the Road", "Slightly Liberal", "Liberal", "Extremely Liberal", "Haven't thought much about it/I don't know", "Prefer not to answer"))

AVCB_wp_dyads$P1_ed <- factor(AVCB_wp_dyads$P1_ed)
levels(AVCB_wp_dyads$P1_ed)
AVCB_wp_dyads$P1_ed <- recode_factor(AVCB_wp_dyads$P1_ed, "Associate's Degree or equivalent 2-year degree"="Associate's Degree or equivalent 2-year degree", "At least one year college"="At least one year of college", "At least one year in college"="At least one year of college","Bachelor's Degree or equivalent 4-year undergraduate degree" = "Bachelor's Degree or equivalent 4-year undergraduate degree", "Graduate Degree"="Graduate Degree", "High School or GED"="High School or GED", "Some graduate training (not completed)"="Some graduate training (not completed)" )

AVCB_wp_dyads$P1_ed <- factor(AVCB_wp_dyads$P1_ed, levels = c("High School or GED", "At least one year of college", "Associate's Degree or equivalent 2-year degree","Bachelor's Degree or equivalent 4-year undergraduate degree", "Some graduate training (not completed)", "Graduate Degree"))
```

In Table \@ref(my_table_chunk), we can see the summary of parents' education levels.

```{r dem table}
library(knitr)
library(kableExtra)

#Gender table
AVCB_wp_dyads$Gender

gender_table <- AVCB_wp_dyads %>% filter(!is.na(Gender)) %>%
  group_by(Gender) %>% 
  summarise(count = n()) %>% 
  mutate(proportion = round(count / sum(count), 2)) %>%
  rename(`Children's Gender` = Gender, N = count, P = proportion)
gender_table

kable(gender_table)

#Race.Eth_group table

race_table <- AVCB_wp_dyads %>% filter(!is.na(Race.Eth_group)) %>%
  group_by(Race.Eth_group) %>% 
  summarise(count = n()) %>% 
  mutate(proportion = round(count / sum(count), 2)) %>%
  rename(`Children's Race/Ethnicity` = Race.Eth_group, N = count, P = proportion)
race_table

kable(race_table)

#Income table

income_table <- AVCB_wp_dyads %>% filter(!is.na(Income)) %>%
  group_by(Income) %>% 
  summarise(count = n()) %>% 
  mutate(proportion = round(count / sum(count), 2)) %>%
  rename(`Parents' Yearly Household Income` = Income, N = count, P = proportion)
income_table

kable(income_table)


#P1_pol

pol_table <- AVCB_wp_dyads %>% filter(!is.na(P1_pol)) %>%
  group_by(P1_pol) %>% 
  summarise(count = n()) %>% 
  mutate(proportion = round(count / sum(count), 2)) %>%
  rename(`Parents' Political Orientation` = P1_pol, N = count, P = proportion)
pol_table

kable(pol_table)

#P1_ed

ed_table <- AVCB_wp_dyads %>% filter(!is.na(P1_ed)) %>%
  group_by(P1_ed) %>% 
  summarise(count = n()) %>% 
  mutate(proportion = round(count / sum(count), 2)) %>%
  rename(`Parents' Education Level` = P1_ed, N = count, P = proportion) 
ed_table

kable(ed_table)

#Merge all together

kable_table1 <- kableExtra::kbl(gender_table, format = "html") %>%
  kableExtra::kable_styling(position = "left", full_width = T)

kable_table2 <- kableExtra::kbl(race_table, format = "html") %>%
  kableExtra::kable_styling(position = "left", full_width = T)

kable_table3 <- kableExtra::kbl(income_table, format = "html") %>%
  kableExtra::kable_styling(position = "left", full_width = T)

kable_table4 <- kableExtra::kbl(pol_table, format = "html") %>%
  kableExtra::kable_styling(position = "left", full_width = T)

kable_table5 <- kableExtra::kbl(ed_table, format = "html") %>%
  kableExtra::kable_styling(position = "left", full_width = T)

# Combine tables vertically using HTML tags
combined_tables <- paste0(kable_table1, kable_table2, kable_table3, kable_table4, kable_table5)

# Save the combined tables to an HTML file or display in R Markdown
cat(combined_tables, file = "combined_tables.html")

#I can't figure out how to do more than this 

```

```{r analyses-descriptives}

# Load necessary libraries
library(tidyverse)
library(psych)
library(stats)
library(lme4)
library(scales)

#descriptive statistics - correlation matrix

#AVCB_wp_dyads_corr <- AVCB_wp_dyads |> 
  #select(Family_ID, COBRAS_avg, CB_Self_Rating_CB_num, CB_Self_Rating_CC_num, CB_Teacher_Rating_CB_num, CB_Teacher_Rating_CC_num, Responsibility_Parents_avg, Responsibility_Schools_avg, Responsibility_Racism_avg,Responsibility_DEI_avg, Self_sum, AV_sum)

AVCB_wp_dyads_corr <- AVCB_wp_dyads |> 
  select(COBRAS_avg, CB_Self_Rating_CB_num, CB_Self_Rating_CC_num, Responsibility_Parents_avg, Responsibility_Schools_avg, Responsibility_Racism_avg,Responsibility_DEI_avg, Self_sum, AV_sum)


AVCB_wp_dyads_corr <- AVCB_wp_dyads_corr %>%
  mutate(AV_sum = AV_sum / 4)

names(AVCB_wp_dyads_corr)[names(AVCB_wp_dyads_corr) == "AV_sum"] <- "Parent_AVscore"


AVCB_wp_dyads_corr <- AVCB_wp_dyads_corr %>%
  mutate(Self_sum = Self_sum / 4)

names(AVCB_wp_dyads_corr)[names(AVCB_wp_dyads_corr) == "Self_sum"] <- "Child_AVscore"



AVCB_wp_dyads_corr <- cor(AVCB_wp_dyads_corr, use = "complete.obs") # using a matrix-like object (e.g., df)
AVCB_wp_dyads_corr

```

```{r analyses-hypothesis tests}

#hypothesis test - doing just 1 for now

#H3: Higher authoritarian values will positively predict more colorblind attitudes (among parents)
#AV_sum --> CB_self_choice (classroom choice)
#Not sure if I should use AV_sum or AV_score for this
#use t-test (comparing difference in means for AV_sum across CB_Self_choice)

#self
aggregate(x= AVCB_wp_parents$AV_sum,     # Numeric variable to be aggregated (mean calculated)
         by = list(AVCB_wp_parents$CB_Self_choice), # Grouping variable
         FUN = mean, na.rm=TRUE) # Function to apply (mean in this case) + Remove NA values during aggregation

t.test(AV_sum ~ CB_Self_choice, data = AVCB_wp_parents)
```

# Methods
We report how we determined our sample size, all data exclusions (if any), all manipulations, and all measures in the study. <!-- 21-word solution (Simmons, Nelson & Simonsohn, 2012; retrieved from http://ssrn.com/abstract=2160588) -->

## Participants

## Material

## Procedure

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.


# Results

# Discussion


\newpage

# References

::: {#refs custom-style="Bibliography"}
:::
